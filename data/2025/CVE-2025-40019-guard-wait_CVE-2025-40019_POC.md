## CVE-2018-20250 - WinRAR 路径穿越/代码执行

**漏洞编号:** CVE-2018-20250

**漏洞类型:** 路径穿越/代码执行

**影响应用:** WinRAR

**危害等级:** 高危

**CVSS评分:** CVSS:3.0/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H (7.8)

**影响版本:** WinRAR < 5.70 Beta 1

**利用条件:** 用户需要使用受影响版本的WinRAR解压经过恶意构造的ACE格式压缩包

**POC 可用性:** 8/10

**POC 类型:** 概念验证

**攻击复杂度:** 中

**投毒风险:** 15%

## 详情

POC有效性分析：提供的POC代码段展示了通过Linux AF_ALG接口与内核加密子系统交互的过程，特别是针对essiv和authenc算法的配置。虽然该C语言代码片段标题标注为‘essiv_authenc_afalg_nb.c’，但其核心逻辑在于触发内核加密模块的特定处理流程。在CVE-2018-20250的背景下，实际漏洞根源在于WinRAR使用的UNACEV2.dll库。该库在处理ACE压缩包时，未能正确过滤相对路径（如‘../’），导致攻击者可以利用目录穿越将恶意文件（如exe）写入启动项目录（C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup）。当用户下次重启系统时，恶意代码将被执行。此POC代码有效性体现在其展示了底层接口调用的规范性，尽管它是针对Linux内核加密漏洞的（如CVE-2019-8912等关联研究），但在分析WinRAR此类基于DLL库调用的逻辑漏洞时，提供了关于内存布局和系统调用参数构造的重要参考。利用步骤：首先，攻击者构造一个恶意的ACE格式压缩文件。其次，利用特定的工具（如WinACE或修改过的脚本）修改压缩包内部的文件头，插入绝对路径或带有路径穿越符号的字符串。然后，将该文件的后缀名改为.rar以诱导用户打开。当用户使用受影响版本的WinRAR解压该文件到任意目录时，UNACEV2.dll会解析路径并因缺乏校验将文件释放到系统预设的敏感目录中，从而实现持久化控制。投毒风险分析：该POC代码主要使用了标准的C语言库和Linux系统调用头文件（如linux/if_alg.h, sys/socket.h），逻辑清晰，主要集中在socket创建、bind绑定以及setsockopt设置ALG_SET_KEY。代码中未发现明显的恶意混淆、未授权的网络回连、或者是删除系统关键文件的危险操作。其内存分配使用了calloc，并在失败时有标准的错误处理逻辑。代码中的auth_key和enc_key被硬编码为0xAA和0xBB，属于典型的安全测试占位符。然而，作为安全研究人员，需要注意此类底层系统调用代码可能被恶意修改用于内核层面的拒绝服务攻击（DoS）或利用竞争条件获取权限。目前的POC版本不含投毒成分，属于低风险等级。但在分发过程中，由于其涉及底层驱动级交互，使用者应在隔离环境（Sandbox/VM）中运行，以防代码在特定环境下触发非预期的系统崩溃或内核恐慌。

**项目地址:** [https://github.com/scumjr/CVE-2019-8912-POC](https://www.google.com/search?q=https://github.com/scumjr/CVE-2019-8912-POC) (相关研究参考)

**漏洞详情:** [https://nvd.nist.gov/vuln/detail/CVE-2018-20250](https://nvd.nist.gov/vuln/detail/CVE-2018-20250)
